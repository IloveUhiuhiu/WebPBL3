@model WebPBL3.DTO.OrderDTO;
@{
    ViewData["Title"] = "Tạo đơn hàng";
    Layout = "_AdminLayout";
    double totalPrice = 0;
}
<div class="card shadow border-0">
    <div class="card-header bg-secondary bg-gradient ml-0 py-3">
        <div class="row">
            <div class="col-12 text-center">
                <h2 class="text-white py-2">Tạo hóa đơn</h2>
            </div>
        </div>
    </div>
    <form id="myForm" method="post">
        <div class="row p-3">
            <div class="col-lg-6 row">
                <div class="col-12">
                    <h4>Thông tin khách hàng</h4>
                </div>
                <div class="col-6 mb-2">
                    <label asp-for="FullName"></label>
                    <input asp-for="FullName" value="@Model?.FullName" type="text" class="form-control">
                </div>
                <div class="col-6">
                    <label asp-for="IdentityCard"></label>
                    <input asp-for="IdentityCard" value="@Model?.IdentityCard" class="form-control">
                </div>
                <div class="col-6 mb-2">
                    <label asp-for="Address"></label>
                    <input asp-for="Address" class="form-control" value="@Model?.Address">
                </div>
                <div class="col-6">
                    <label asp-for="PhoneNumber"></label>
                    <input asp-for="PhoneNumber" value="@Model?.PhoneNumber" class="form-control">
                </div>
                <div class="col-6">
                    <label asp-for="Email"></label>
                    <input asp-for="Email" value="@Model?.Email" class="form-control">
                </div>
                <div class="col-12 mt-3">
                    <h4>Thêm sản phẩm</h4>
                </div>
                    <div class="row align-items-end col-12">
                        <div class="col-4">
                            <label>Mã xe</label>
                            <input name="CarID" class="form-control">
                        </div>
                        <div class="col-4">
                            <label>Số luọng</label>
                            <input name="quantity" class="form-control">
                        </div>
                        <div class="col-2">
                            <button type="submit" onclick="submitForm('@Url.Action("AddItem", "Order")')" class="btn btn-success mr-2">Thêm ô tô</button>
                        </div>
                    </div>
            </div>
            <div class="col-lg-6">
                <div class="col-12">
                    <h4>Thông tin đơn hàng</h4>
                </div>
                <div class="form-group col-12 row">
                    <label class="col-4">Ngày tạo đơn hàng: </label>
                    <div class="col-4">
                        <input type="date" asp-for="Date" class="form-control">
                    </div>
                </div>
                <table class="table table-striped col-12 p-2">
                    <thead>
                        <tr>
                            <th>
                                STT
                            </th>
                            <th>
                                Tên xe
                            </th>
                            <th>
                                Số lượng
                            </th>
                            <th>
                                Đơn giá
                            </th>
                            <th>
                                Thành tiền
                            </th>
                            <th>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model.items.Count != 0)
                        {
                            int count = 0;
                            foreach (var car in Model.items)
                            {
                                totalPrice += car.price * car.quantity;
                                <tr>
                                    <input asp-for="items[count].CarID" hidden />
                                    <input asp-for="items[count].CarName" hidden />
                                    <input asp-for="items[count].price" hidden />
                                    <input asp-for="items[count].quantity" hidden />
                                    <td>@(++count)</td>
                                    <td>@car.CarName</td>
                                    <td>@car.quantity</td>
                                    <td>@car.price.ToString("C", new System.Globalization.CultureInfo("vi-VN"))</td>
                                    <td>@((car.price * car.quantity).ToString("C", new System.Globalization.CultureInfo("vi-VN")))</td>
                                    <td>
                                        <a class="btn btn-danger delete-item" data-car-id="@car.CarID">
                                            <i class="fa-solid fa-trash"></i>
                                            Xóa
                                        </a>
                                    </td>
                                </tr>
                            }
                            <input asp-for="Totalprice" value="@totalPrice" hidden />
                        }
                    </tbody>
                </table>
                <div class="col-12 text-end">
                    <h5 style="text-align: end">Tổng tiền: @totalPrice.ToString("C", new System.Globalization.CultureInfo("vi-VN"))</h5>
                </div>
                <div class="col-12 row mt-2">
                    <label class="col-5">Trạng thái thanh toán:</label>
                    <select class=" col-4 form-select form-select" asp-for="Status">
                        <option value=" " selected>Tình trạng</option>
                        <option value="Đã thanh toán">Đã thanh toán</option>
                        <option value="Chưa thanh toán">Chưa thanh toán</option>
                    </select>
                </div>

            </div>
        </div>
        <div class="row col-12 d-flex justify-content-center mt-4">
            <button type="submit" onclick="submitForm('@Url.Action("Create", "Order")')" class="btn btn-primary col-3 mr-2">Tạo hóa đơn</button>
            <a asp-action="Index" asp-controller="Order" class="btn btn-danger col-3">Hủy</a>
        </div>
    </form>
</div>

<script>
    function submitForm(action) {
        document.getElementById('myForm').action = action;
        document.getElementById('myForm').submit();
    }

     
        var deleteItems = document.querySelectorAll(".delete-item");
        deleteItems.forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                const carId = e.target.getAttribute('data-car-id');
                const form = document.getElementById('myForm');
                const hiddenInput = document.createElement('input');
                hiddenInput.type = 'hidden';
                hiddenInput.name = 'delItemId';
                hiddenInput.value = carId;
                form.appendChild(hiddenInput);
                submitForm('/Order/DeleteItem');
            })
        })
 </script>